# Theology AI Lab v2.0 - GUI 사용 가이드

## 개요

Theology AI Lab은 신학 연구를 위한 로컬 벡터 데이터베이스 검색 시스템입니다. PDF/TXT 문서를 업로드하면 자동으로 청킹 및 벡터화하여 의미 기반 검색이 가능합니다.

**실행 방법:**
```bash
cd 03_System
source venv/bin/activate
streamlit run app.py
```

**접속 주소:** http://localhost:8501

---

## 사이드바 구성

### 타이틀 영역
- **📚 Theology AI Lab**: 앱 이름
- **v2.0**: 현재 버전

### 메뉴
| 메뉴 | 설명 |
|------|------|
| 🔍 검색 | 벡터 데이터베이스 검색 |
| 📤 파일 업로드 | PDF/TXT 파일 처리 |
| 📊 통계 | 데이터베이스 통계 및 소스 관리 |
| ⚙️ 설정 | API 키 및 앱 설정 |

### 옵시디언 연동
- **🟣 옵시디언 열기**: 설정된 Obsidian Vault를 엽니다
- 설정 페이지에서 Vault 경로를 먼저 지정해야 합니다

### 푸터
- **☕ 책 한 권 사주셔서 응원해주세요**: kerygma.co.kr 후원 링크
- **© 2025 케리그마출판사**: 저작권 정보

---

## 1. 🔍 검색 페이지

### 기본 검색
1. 검색어 입력란에 질문 또는 키워드 입력
2. **검색** 버튼 클릭 또는 Enter
3. 유사도 기반으로 관련 청크 반환

### 검색 옵션
- **검색 결과 수**: 반환할 청크 개수 (기본 10개)
- **소스 필터**: 특정 사전/문서만 검색 (선택)

### 검색 결과
각 결과는 확장 패널로 표시:
- **[순번] 소스명** - p.페이지번호 | 표제어
- 분류 태그 (있는 경우)
- 본문 내용

### 검색 결과 내보내기
검색 결과 상단에 4개 버튼:

| 버튼 | 기능 |
|------|------|
| 📥 다운로드 | 마크다운(.md) 파일로 다운로드 |
| 📋 복사 | 클립보드 복사용 텍스트 표시 |
| 🟣 옵시디언 | Obsidian Vault에 직접 저장 |
| 🤖 AI 분석 | AI가 검색 결과를 분석하여 리포트 생성 |

### AI 분석 기능 (🤖)
API 키가 설정된 경우 검색 결과를 기반으로 AI 분석 리포트를 생성합니다:

1. 검색 수행 후 **🤖 AI 분석** 버튼 클릭
2. 설정된 AI 모델이 검색 결과를 컨텍스트로 종합 분석
3. 리포트 생성 완료 후:
   - **📥 리포트 다운로드**: 마크다운 파일로 저장
   - **🟣 옵시디언 저장**: Obsidian Vault에 직접 저장
4. 지원 모델: Anthropic Claude, OpenAI GPT, Google Gemini

---

## 2. 📤 파일 업로드 페이지

### 지원 파일 형식
- **PDF**: 텍스트 추출 가능한 PDF (OCR PDF는 별도 처리 필요)
- **TXT**: 일반 텍스트 파일

### 업로드 프로세스
1. 파일 드래그 앤 드롭 또는 **Browse files** 클릭
2. (선택) 페이지 매핑 설정
3. **🚀 처리 시작** 버튼 클릭
4. 처리 진행 상황 실시간 표시
5. 완료 시 자동으로 ChromaDB에 인덱싱

### 페이지 매핑 설정
PDF 페이지 번호와 실제 인쇄본 페이지가 다른 경우:

1. **페이지 매핑 사용** 체크박스 선택
2. 샘플 포인트 설정 (2~10개)
   - **➕ 추가**: 샘플 포인트 추가
   - **➖ 제거**: 샘플 포인트 제거
3. 각 샘플에서:
   - **PDF**: PDF 뷰어에서 보이는 페이지 번호
   - **종이**: 실제 인쇄된 페이지 번호 (없으면 0)

### 처리 결과
- 청크 수, 표제어 수, 처리 시간 표시
- 오류 발생 시 상세 메시지 표시

---

## 3. 📊 통계 페이지

### 데이터베이스 개요
- **총 청크 수**: 인덱싱된 전체 텍스트 청크
- **소스 수**: 등록된 문서/사전 종류
- **마지막 업데이트**: 최근 인덱싱 시간

### 소스별 통계
| 항목 | 설명 |
|------|------|
| 소스 | 사전/문서 약어 |
| 유형 | 사전, 단행본, 논문 등 |
| 권수 | 볼륨 수 |
| 청크 | 해당 소스의 청크 수 |

### 차트
- 상위 10개 소스의 청크 분포 막대 차트

### 소스 관리 (삭제)
- 각 소스 옆 **🗑️** 버튼으로 개별 삭제 가능
- 삭제 시 해당 소스의 모든 청크가 ChromaDB에서 제거됨
- 통계는 실시간으로 DB 상태를 반영 (삭제 즉시 목록에서 사라짐)

---

## 4. ⚙️ 설정 페이지

### 앱 타이틀 설정
- 검색 페이지에 표시되는 타이틀 커스터마이징
- 예: "신학 데이터베이스" → "My Digi-Th-Library"

### Obsidian 연동 설정
- Vault 경로 입력 (절대 경로)
- 예: `/Users/username/Documents/MyVault`
- 경로 유효성 자동 확인

### API 프로바이더 설정

#### Anthropic (Claude)
- API 키 입력
- 모델 선택:
  - claude-3-5-sonnet-20241022 (권장)
  - claude-3-opus-20240229
  - claude-3-haiku-20240307

#### OpenAI (GPT)
- API 키 입력
- 모델 선택:
  - gpt-4o (권장)
  - gpt-4-turbo
  - gpt-3.5-turbo

#### Google (Gemini)
- API 키 입력
- 모델 선택:
  - gemini-1.5-pro (권장)
  - gemini-1.5-flash

### RAG 설정
- **최대 토큰**: AI 응답의 최대 길이 (기본 4096)

### 설정 저장
- **💾 설정 저장** 버튼으로 `.env` 파일에 저장
- 일부 설정은 페이지 새로고침 후 적용

---

## 파일 구조

```
Theology_AI_Lab_v2/
├── 01_Library/
│   ├── inbox/          # PDF/TXT 업로드 폴더
│   └── archive/        # 처리된 JSON 파일
├── 02_Brain/
│   └── vector_db/      # ChromaDB 데이터
├── 03_System/
│   ├── app.py          # Streamlit GUI
│   ├── venv/           # Python 가상환경
│   └── utils/          # 유틸리티 모듈
└── .env                # 환경 설정
```

---

## 환경 변수 (.env)

```env
# 경로 설정
INBOX_DIR=./01_Library/inbox
ARCHIVE_DIR=./01_Library/archive
CHROMA_DB_DIR=./02_Brain/vector_db

# API 키
ANTHROPIC_API_KEY=sk-ant-...
OPENAI_API_KEY=sk-...
GOOGLE_API_KEY=...

# RAG 설정
RAG_MODEL=claude-3-5-sonnet-20241022
RAG_MAX_TOKENS=4096

# 앱 설정
APP_TITLE=신학 데이터베이스
OBSIDIAN_VAULT=/path/to/vault
```

---

## 문제 해결

### 검색 결과가 없음
1. 데이터베이스에 문서가 있는지 통계 페이지에서 확인
2. 파일 업로드 후 인덱싱이 완료되었는지 확인

### AI 분석 오류
1. 설정 페이지에서 API 키 확인
2. API 키 유효성 및 잔액 확인
3. 모델 선택이 올바른지 확인
4. 지원 프로바이더: Anthropic, OpenAI, Google

### Obsidian 저장 실패
1. Vault 경로가 올바른지 확인
2. 경로에 쓰기 권한이 있는지 확인
3. Obsidian 앱이 설치되어 있는지 확인

### 페이지 매핑 오류
1. 최소 2개 이상의 샘플 포인트 필요
2. PDF 페이지 번호가 순차적이어야 함
3. 종이 페이지 번호가 0이면 해당 구간은 번호 없음 처리

---

## 버전 히스토리

### v2.1 (2025-12-30)
- **🤖 AI 분석 기능 추가**: 검색 결과 기반 AI 리포트 생성
- **소스 관리 개선**: 통계 페이지에서 실시간 DB 상태 반영
- **인박스 자동 정리**: 처리 완료된 파일 자동 정리
- **Lemma 인덱스 메뉴 제거**: 벡터 검색으로 통합
- **옵시디언 아이콘 통일**: 🟣로 통일
- **안정성 개선**: tokenizers 멀티스레드 충돌 수정

### v2.0 (2025-12-29)
- Streamlit GUI 추가
- Obsidian 연동 기능
- 동적 페이지 매핑 (2-10개 샘플)
- 검색 결과 내보내기 (다운로드/복사/옵시디언)
- 사용자 정의 앱 타이틀
- 다중 AI 프로바이더 지원 (Claude, GPT, Gemini)

### v1.0
- CLI 기반 PDF 처리
- ChromaDB 벡터 인덱싱
- 기본 검색 기능
