# Theology AI Lab v2 - Docker Compose
# ====================================
# 원클릭 실행: docker compose up -d

services:
  theology-lab:
    build:
      context: ./03_System
      dockerfile: Dockerfile
    container_name: theology-ai-lab

    # 포트 매핑
    ports:
      - "8000:8000"  # MCP HTTP 서버
      - "8501:8501"  # Streamlit GUI

    # 볼륨 마운트 (데이터 영속화)
    volumes:
      # 라이브러리 (inbox + archive)
      - ./01_Library:/app/01_Library
      # 벡터 DB (ChromaDB)
      - ./02_Brain/vector_db:/app/vector_db

    # 환경 변수
    environment:
      - CHROMA_DB_DIR=/app/vector_db
      - ARCHIVE_DIR=/app/01_Library/archive
      - INBOX_DIR=/app/01_Library/inbox
      - OCR_ENABLED=true
      - LOG_LEVEL=INFO

    # 재시작 정책
    restart: unless-stopped

    # 헬스체크
    healthcheck:
      test: ["CMD", "python", "-c", "import socket; s=socket.socket(); s.connect(('localhost',8000)); s.close()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

# 네트워크 설정 (향후 확장용)
networks:
  default:
    name: theology-network
